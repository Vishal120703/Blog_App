<%- include('element/header') %>
<%- include('element/navbar') %>

<section class="container py-5">
  <div class="card shadow-lg p-4 mx-auto" style="max-width: 800px;">
    <% if (blog.image) { %>
      <img src="<%= blog.image %>" class="img-fluid rounded mb-4" alt="Blog Image">
    <% } %>
    <h2 class="text-primary mb-3"><%= blog.title %></h2>
    <p class="text-muted">By <%= blog.auther %> | <%= blog.date.toDateString() %></p>
    <hr>
    <p class="lead text-secondary"><%= blog.content %></p>
  </div>

  <!-- Like Button -->
  <!-- <form action="/post/<%= blog._id %>/like" method="POST" class="d-inline">
    <button type="submit" class="btn btn-outline-danger mt-3">‚ù§Ô∏è Like</button>
  </form> -->
  <button 
  id="likeBtn" 
  data-id="<%= blog._id %>" 
  class="btn btn-outline-danger mt-3">
  ‚ù§Ô∏è Like (<span id="likeCount"><%= blog.likes %></span>)
</button>

  <!-- ‚úÖ Comment Field -->
  <form action="/post/<%= blog._id %>/comment" method="POST" class="mt-4">
    <div class="mb-3">
      <textarea
        name="comment"
        id="comment"
        class="form-control"
        rows="3"
        placeholder="Write your comment..."
        required
      ></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Post Comment</button>
  </form>
  <div class="mt-5" style="max-width: 800px;">
    <h4 class="mb-3">Comments</h4>

    <% if (blog.comments && blog.comments.length > 0) { %>
      <% blog.comments.forEach(comment => { %>
        <div class="card p-3 mb-2 shadow-sm">
          <strong><%= comment.user %></strong>
          <p class="mb-1"><%= comment.text %></p>
        </div>
      <% }) %>
    <% } else { %>
      <p class="text-muted">No comments yet. Be the first to comment!</p>
    <% } %>
  </div>
</section>
<script>
document.getElementById("likeBtn").addEventListener("click", async function() {
    const postId = this.dataset.id;

    const res = await fetch(`/post/${postId}/like`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        }
    });

    const data = await res.json();

    if (data.success) {
        // Update like count instantly
        document.getElementById("likeCount").innerText = data.likes;

        // Change button text
        if (data.liked) {
            this.innerHTML = `‚ù§Ô∏è Liked (<span id="likeCount">${data.likes}</span>)`;
        } else {
            this.innerHTML = `ü§ç Like (<span id="likeCount">${data.likes}</span>)`;
        }
    }
});
</script>


<%- include('element/footer') %>
